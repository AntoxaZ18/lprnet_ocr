### 
Этот проект реализует систему распознавания номеров транспортных средств (LPR), используя модель LPRNet в сочетании с Spatial Transformer Network (STN) для повышения точности и устойчивости к искажениям.

### Содержание
- [Основные возможности](#Основные-возможности)
- [Обзор моделей](#Обзор-моделей)
- [Требования](#Требования)
- [Пример работы](#Пример-работы)
- [Датасет](#Датасет)
- [Установка через Poetry](#Установка-через-Poetry)
- [Обучение](#Обучение)
- [Инференс](#Инференс)
- [Оценка](#Оценка)
- [Экспорт в ONNX](#Экспорт-в-ONNX)
- [Тест производительности ONNX](#Тест-производительности-ONNX)
- [Примечания](#Примечания)
  
# Основные возможности
Модель распознавания состоит из следующих частей:
LPRNet : Легковесная модель на основе CNN для детекции и распознавания символов на номерах.
STN (Spatial Transformer Network) : Повышает способность модели обрабатывать повернутые или искаженные номера.
Полностью автоматизированный пайплайн : От входного изображения до вывода текста номера.
Поддержка различных форматов : Может быть адаптирован под номера разных стран.

# Обзор моделей
LPRNet
- Основан на архитектуре ResNet-18.
- Разработан для работы в реальном времени.
- Использует CTC (Connectionist Temporal Classification) для последовательного распознавания.
  
STN (Spatial Transformer)
- Добавляет возможность пространственной трансформации для выравнивания повернутых номеров.
- Повышает обобщаемость модели на искажённые изображения.

# Требования
Убедитесь, что у вас установлены следующие библиотеки:
- Poetry
- Python 3.11+

# Датасет
В проекте используется [датасет](https://huggingface.co/datasets/AY000554/Car_plate_OCR_dataset/tree/main) 

Car_plate_OCR_dataset - это набор данных из примерно 45,5К изображений российских номеров автомобилей одного типа (рисунок 1) и их разметки в виде текста. Этот набор данных предназначен для обучения нейронных сетей распознаванию номера автомобиля по изображению номера.
Основан на датасете из проекта [Nomeroff Net](https://nomeroff.net.ua/#). По сравнению с оригинальным набором данных были удалены некоторые изображения не соответствующие формату разметки (которые имели иное имя файла, не являющееся содержанием номера).

Данные разбиты на подвыборки для обучения, тестирования и валидации:
|Типп выборки данных | Количество изображений |
| ------------- | ------------- |
| train | 37775 (83%) |
| val   | 4891 (10,7%) |
| test  | 2845 (6.3%) |
| all images | 45514 |

# Установка через Poetry
1. Клонируйте репозиторий
   ```Powershell
   git clone https://github.com/AntoxaZ18/lprnet_ocr.git
   cd lprnet_ocr
   ```

2. Установите вирутальную среду и зависимости через Poetry
   Если хотите чтобы вирутальная среда создалась в папке с проектом
   ```Powershell
   poetry config settings.virtualenvs.in-project true
   ```
   Создайте преднастроенную виртуальную среду
   ```Powershell
   poetry install
   ```
   Активируйте среду при помощи poetry (опционально)
   ```Powershell
   poetry env activate
   ```

# Обучение
Для обучения через make:
Через Python

где файл конфигурации словаря в формате

# Инференс
Результат будет отображать распознанный текст номера.

Запуск через make:
Через Python:

# Оценка
Можно оценить модель по метрикам:

точность распознавания номера
точность распознавания символов

stn - модель STN
lpr - модель LPRnet
images - путь до изображений

Запуск через Python
model_metrics.py --stn stn_best.pth --lpr lpr_best.pth --images ./val/img


# Экспорт в ONNX

Для экспорта необходимо передать параметры
stn - путь до STN модели
lpr - путь до LPRnet модели
out - путь к экспортированной модели

Через make:

Через Python
   ```Powershell
   python export_onnx.py --stn stn_best.pth --lpr lpr_best.pth --out exported.onnx
   ```

# Тест производительности ONNX

model - путь до модели полученной на предыдущем шаге
image - путь до изображения
runs - количество запусков по которым усредняется

запускается на батче из 8 изображений

onnx_inference.py --model exported.onnx --image cropped____.jpg --runs 10

# Примечания

Модель обучена на российских номерах, но может быть адаптирована под другие форматы.
Для лучшей производительности используйте качественные изображения с четкими номерами.
STN помогает обрабатывать повернутые или искажённые номера, повышая общую точность.
Получившиеся метрики:

